# Лабораторная работа №2: Трекинг объекта на видео на основе ключевых точек

<img width="1578" height="822" alt="image" src="https://github.com/user-attachments/assets/c0d90d6e-5275-4f03-81a7-d4c373e85485" />


**Цель работы:** Реализация и тестирование алгоритма трекинга объекта на видео с использованием детектора ключевых точек Shi-Tomasi и оптического потока Лукаса-Канаде.

## 1. Теоретическая база

### 1.1 Метод Shi-Tomasi для обнаружения ключевых точек
Алгоритм Shi-Tomasi ("Good Features to Track") является улучшением детектора углов Харриса. Он основан на анализе матрицы вторых моментов (автокорреляционной матрицы). В отличие от детектора Харриса, метод Shi-Tomasi использует минимальное собственное значение матрицы M. Точка считается угловой, если минимальное из собственных значений превышает заданный порог. Этот критерий позволяет получать более устойчивые к шуму и лучше распределенные точки.

### 1.2 Оптический поток Лукаса-Канаде
Оптический поток описывает векторное поле смещений пикселей между последовательными кадрами видео. Метод Лукаса-Канаде основан на предположениях о постоянстве яркости, малом перемещении и пространственной согласованности. Для обработки больших перемещений используется пирамидальный подход.

## 2. Описание разработанной системы

### 2.1 Архитектура алгоритма
Разработанный алгоритм реализует следующий рабочий процесс:

1. **Инициализация**:
   - Загрузка входного видеофайла
   - Извлечение первого кадра как эталонного изображения
   - Поиск ключевых точек методом Shi-Tomasi на первом кадре
   - Построение начальной ограничивающей рамки

2. **Обработка кадров**:
   - Расчет оптического потока между кадрами
   - Фильтрация успешно отслеженных точек
   - Оценка гомографии для обновления рамки
   - Визуализация результатов

3. **Обработка особых случаев**:
   - Детекция размытых кадров (пропуск обновления)
   - Минимальное количество inliers для обновления гомографии

### 2.2 Ключевые параметры
**Параметры Shi-Tomasi:**
- maxCorners: 500
- qualityLevel: 0.05  
- minDistance: 10
- blockSize: 7

**Параметры Лукаса-Канаде:**
- winSize: (15, 15)
- maxLevel: 3
- критерии: (cv2.TERM_CRITERIA_EPS | cv2.TERM_CRITERIA_COUNT, 10, 0.03)

### 2.3 Особенности реализации
- **Детекция размытия:** Использование лапласиана для пропуска размытых кадров
- **Гомография:** Применение RANSAC для оценки перспективного преобразования
- **Вращающийся прямоугольник:** Использование cv2.minAreaRect() для точного охвата точек
- **Perspective Transform:** Обновление рамки с учетом перспективных искажений

## 3. Результаты работы и тестирования системы

### 3.1 Тестирование на различных видео
Программа была протестирована на:
1. **Тестовых видео:** Устойчивый трекинг при плавном движении
2. **Пользовательском видео:** Хорошие результаты для текстурированных объектов

### 3.2 График зависимости числа ключевых точек от времени

Для анализа работы алгоритма была построена зависимость количества отслеживаемых ключевых точек от времени:

<img width="888" height="392" alt="image" src="https://github.com/user-attachments/assets/2f96e958-612d-4e66-99df-a0a43c1057c8" />



На графике видно:
- Начальное количество точек: ~300
- Стабильное удержание точек в диапазоне 50-200 на протяжении всего видео
- Периодические переинициализации (резкие увеличения количества точек)
- Общая тенденция к снижению количества точек со временем, что соответствует теории оптического потока

### 3.3 Количественные результаты

Кадр 60, blur=19, H_updates=40, pts=172
Кадр 90, blur=19, H_updates=70, pts=172
Кадр 120, blur=19, H_updates=100, pts=171
Кадр 150, blur=19, H_updates=130, pts=171
Кадр 180, blur=19, H_updates=160, pts=171
Кадр 210, blur=19, H_updates=190, pts=171
Кадр 240, blur=19, H_updates=220, pts=171
Кадр 270, blur=19, H_updates=250, pts=171
Кадр 300, blur=19, H_updates=280, pts=171
Кадр 330, blur=19, H_updates=310, pts=171
Кадр 360, blur=19, H_updates=340, pts=171
Кадр 390, blur=19, H_updates=370, pts=170
Кадр 420, blur=28, H_updates=391, pts=167
Кадр 450, blur=28, H_updates=421, pts=167
Кадр 480, blur=28, H_updates=451, pts=163
Кадр 510, blur=28, H_updates=481, pts=163
Кадр 540, blur=28, H_updates=511, pts=163
Всего кадров: 558, blur кадров: 28, обновлений H: 529

## 4. Выводы по работе

1. **Эффективность:** Алгоритм хорошо работает для текстурированных объектов при плавном движении
2. **Ограничения:** Быстрые движения и сильные окклюзии снижают точность
3. **Практическое применение:** Подходит для отслеживания плоских текстурированных объектов

## 5. Использованные источники

1. OpenCV Documentation: Optical Flow и Feature Detection
2. Shi, J., & Tomasi, C. (1994). Good features to track
3. Lucas, B. D., & Kanade, T. (1981). An iterative image registration technique
